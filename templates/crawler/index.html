{% extends 'crawler/base.html' %}
{% load static %}
{% load crawler_extras %}


{% block head %}

<style>
/**
 * 13.0 - Pagination
 */
 .pagination-simple {
    padding-left: 30px;
    font-size: 16px;
}

.pagination ul {
    list-style: none;
}

.pagination ul li {
    display: inline-block;
    font-size: 16px;
    margin-right: 5px;
}

.current a {
    color: red;
}
</style>

{% endblock head %}

{% block main %}
<div class="container-fluid">
    <a href="{% url 'crawler:create' %}" class="btn btn-info">Add</a>
    <table class="table table-bordered">
        <thead class="thead-dark">
          <tr>
            <th scope="col">道具ID</th>
            <th scope="col">道具名</th>
            <th scope="col">精炼等级</th>
            <th scope="col">期望价格</th>
            <th scope="col">寻得数</th>
            <th scope="col">现存数</th>
            <th scope="col">最高价</th>
            <th scope="col">最低价</th>
            <th scope="col">均价</th>
            <th scope="col">更新时间</th>
            <th scope="col">删除</th>
          </tr>
        </thead>
        <tbody>
            {% for wanted_item in wanted_item_list %}
            <tr>
                <th scope="row">
                    <a href="https://odinro.online/item/view/?id={{wanted_item.base_item.pk}}" target="_blank">{{wanted_item.base_item.pk}}</a>
                </th>
                <td>
                {% if wanted_item.catcheditem_set.all %}
                <a class="btn btn-primary" data-toggle="collapse" href="#multi{{wanted_item.pk}}" role="button" aria-expanded="false" aria-controls="multi{{wanted_item.pk}}">
                    {{wanted_item.base_item.name}}
                </a>
                {% else %}
                {{wanted_item.base_item.name}}
                {% endif %}
                </td>
                <td>{{wanted_item.level}}</td>
                <td>{{wanted_item.upper_price|price2string}}</td>
                <td>{{wanted_item.catcheditem_set.all.count}}</td>
                <td>{{wanted_item.num}}</td>
                <td>{{wanted_item.highest_price|price2string}}</td>
                <td>{{wanted_item.lowest_price|price2string}}</td>
                <td>{{wanted_item.avg_price|price2string}}</td>
                <td>{{wanted_item.time|date:"H:i n/d"}}</td>
                <td>
                    <form method="POST" action="{% url 'crawler:delete' wanted_item.pk %}">
                        {% csrf_token %}
                        <input class="btn btn-danger" type="submit" value="Confirm">
                    </form>
                </td>
            </tr>
            {% empty %}
            {% endfor %}

        </tbody>
    </table>
    {% for wanted_item in wanted_item_list %}
        {% if wanted_item.catcheditem_set.all %}
        <div class="row justify-content-md-center">
            <div class="collapse multi-collapse col-md-12" id="multi{{wanted_item.pk}}">
            <div class="card">
                <h5 class="card-header">{{wanted_item.base_item.name}}</h5>
                <div class="card card-body">
                    <table class="table-bordered">
                        <thead class="thead-light">
                            <tr>
                                <th scope="col">商店名称</th>
                                <th scope="col">坐标信息</th>
                                <th scope="col">卡槽1</th>
                                <th scope="col">卡槽2</th>
                                <th scope="col">卡槽3</th>
                                <th scope="col">卡槽4</th>
                                <th scope="col">数量</th>
                                <th scope="col">单价</th>
                            </tr>
    
                        </thead>
                        <tbody>
                            {% for catched_item in wanted_item.catcheditem_set.all %}
                            <tr>
                                <td>
                                    <a href="https://odinro.online/vending/viewshop/?id={{catched_item.store_item.store_id}}" target="_blank">{{catched_item.store_item.store_name}}</a>
                                </td>
                                <td>{{catched_item.store_item.position}}</td>
                                <td>{{catched_item.store_item.hole_1}}</td>
                                <td>{{catched_item.store_item.hole_2}}</td>
                                <td>{{catched_item.store_item.hole_3}}</td>
                                <td>{{catched_item.store_item.hole_4}}</td>
                                <td>{{catched_item.store_item.num}}</td>
                                <td>{{catched_item.store_item.price}}</td>
                            </tr>
                            {% empty %}
                            {% endfor %}
                        </tbody>
                    </table>
    
                </div>
            </div>

            </div>
        </div>
        {% else %}
        {% endif %}
    {% empty %}
    {% endfor %}

    {% if is_paginated %}

    <div class="pagination">
      {% if first %}
        <a href="?page=1">1</a>
      {% endif %}
      {% if left %}
        {% if left_has_more %}
            <span>...</span>
        {% endif %}
        {% for i in left %}
            <a href="?page={{ i }}">{{ i }}</a>
        {% endfor %}
      {% endif %}
      <a href="?page={{ page_obj.number }}" style="color: red">{{ page_obj.number }}</a>
      {% if right %}
        {% for i in right %}
            <a href="?page={{ i }}">{{ i }}</a>
        {% endfor %}
        {% if right_has_more %}
            <span>...</span>
        {% endif %}
      {% endif %}
      {% if last %}
        <a href="?page={{ paginator.num_pages }}">{{ paginator.num_pages }}</a>
      {% endif %}
    </div>
    {% endif %}
</div>

{% endblock main %}